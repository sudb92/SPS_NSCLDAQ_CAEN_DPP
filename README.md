### NSCLDAQ-CAEN-DPP
----------------

* A collection of utilities that interface CAEN digitizers 1730/25 running DPP-PHA or DPP-PSD firmwares with NSCLDAQ
* List of utilities
	+ XML Editor
	+ SpecTcl
	+ scalerDisplay
	+ Readout
	+ RawRingAnalyser-DPP
	+ EvbRingAnalyser-DPP
* List of dependencies
	+ nscldaq-11.4-009 or 11.3-019
	+ spectcl-5.3-008
	+ pugixml-1.8
	+ CAENVMELib-2.41
	+ CAENDigitizer_2.7.9 or CAENDigitizer_2.7.9
	+ CAENComm-1.2
	+ root v6.14.02 (version tested on)
	+ CoMPASS v1.3.0

----------------------------------
### Brief description of utilities:

#### XML Editor
----------

* Run from terminal as 'tclsh tweaker.tcl'
* Allows real time edits to an XML file generated by Compass

#### SpecTcl-Analyser
----------------

+ Borrows from the ReadNSCLDAQFiles framework in http://docs.nscl.msu.edu/daq/newsite/nscldaq-11.4/c4826.html
+ Abstract class CFragmentHandler inherits to class CDppFragmentHandler which can hold/return a DppEvent
+ CDppFragmentHandler inherits to CPSDFragmentHandler and CPHAFragmentHandler
+ The unique size for PSD and PHA fragments is used by CRawUnpacker.cpp to distinguish them with 	CRingItemDecoder
+ TODO: PSD Fine timestamp lives in 'Extras'- Needs better implementation before testing with focalplane signals
+ Run as ./SpecTcl 
+ Needs tailoring per experiment

#### ScalerDisplay
-------------

+ Readout updates scaler counts to reflect the rate at which the last 128 triggers were recorded. 
+ Run as ScalerDisplay scaler-file.def from terminal. Two example .def files are included. One for the raw counted/missed trigger rates,
the other providing the ratio of missed/counted in addition. 

#### RawRingAnalyser-DPP
------------------------

+ Parses unbuilt DPP ringbuffer data to either print a formatted stream to the console, or save it into a ROOT tree
+ Format: ./Analyser <file/ringname> (option)
+ With (option): ROOT - save to root tree, DUMP - print to screen
+ Compass tree is saved with the naming template compass_run_x.root in the directory specified in evt2root_input.txt

#### EvbRingAnalyser-DPP
------------------------

+ Parses eventbuilt DPP ringbuffer data, usage same as above


#### Readout
-------

+ Kindly refer to the README within the Readout folder

#### Suggested run scheme
---------

+ Use ReadoutShell with the correct eventbuilder settings. See sample ReadoutCallouts.tcl and .settings.tcl files in folder 'Evb+XML Files for testing'
+ Set wide eventbuilding windows (10000-50000 ns) at first, inspect the performance of the builder using Raw/EvbRingAnalyser-DPP instead of dumper
+ During runtime, if parameters are in need of changing, 'pause' the run and make edits with the XML Editor. If the XML source is saved
with new data, unpausing the run loads the updated XML parameters automatically. Optimize all digitizer parameters before recording data in a run.